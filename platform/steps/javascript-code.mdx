---
title: JavaScript Code
description: Execute custom logic to manipulate data and control flow
icon: "code"
---

The **JavaScript Code** step executes custom JavaScript logic to manipulate data, perform calculations, or apply conditional logic within your SmartAgent workflows.

## Overview

The JavaScript Code step securely runs vanilla JavaScript in a VM. It provides flexibility to implement custom business logic, data transformations, and conditional operations. Write standard JavaScript (ES6+) that can access variables from previous steps and return results to be used in subsequent steps.

<div align="center">
  ![JavaScript Code Step](/images/steps/js-step.png)
</div>

## Settings

### JS Code

Write JavaScript code that will be executed during the workflow. **The last expression is automatically returned** as the step output.

**Available variables:**
- Access any variable from previous steps or conversation context
- Use standard JavaScript syntax and operators

**Example - Calculate order total:**
```javascript
const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
const tax = subtotal * 0.08;
const shipping = subtotal > 50 ? 0 : 5.99;

subtotal + tax + shipping
```

**Example - Determine priority:**
```javascript
const isPremium = customer_tier === 'premium';
const isUrgent = message.toLowerCase().includes('urgent');

if (isPremium && isUrgent) {
  'critical'
} else if (isPremium) {
  'high'
} else {
  'normal'
}
```

**Example - Format data:**
```javascript
const fullName = `${first_name} ${last_name}`.trim();
const formattedPhone = phone.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');

{ fullName, formattedPhone }
```

## Outputs

### Output

Name of the variable where the JavaScript output will be saved. Can be referenced in subsequent steps using `{variable_name}`.

**Default:** `js_output`

### Next Steps

The step(s) to execute after this step completes. Select from existing steps or enter a custom step name using variables.

### Send to Copilot

When enabled, sends the output to the Copilot app for agent review before sending to the user.

### Send Automatically

When enabled, sends the output directly to the user without requiring confirmation.

## Advanced Settings

### Follow Up Steps

Steps that run in parallel after this step completes. Use this for actions that don't need to block the workflow, such as logging or analytics.

### Background Steps

Steps that run in the background while the main workflow continues. Useful for long-running tasks that shouldn't delay the response.

### Write Outputs to Background Context

When enabled, saves the step output to the background context, making it available to all subsequent steps in the conversation without explicitly passing it.

## Common Use Cases

### Data Transformation
Convert data formats, combine fields, or restructure objects.

```javascript
const orderDate = new Date(order_timestamp).toLocaleDateString();
const status = order_status.toUpperCase();

`Order placed on ${orderDate} is ${status}`
```

### Business Logic
Implement organization-specific rules and calculations.

```javascript
const canReturn =
  order_date > Date.now() - (30 * 24 * 60 * 60 * 1000) && // Within 30 days
  !is_final_sale &&
  order_status === 'delivered';

canReturn
```

### Conditional Logic for Routing
Use conditional logic to determine the next step for the [Router step](/platform/steps/router).

```javascript
let next_step;
if (issue_resolved && customer_satisfied) {
  next_step = 'closing';
} else if (needs_escalation) {
  next_step = 'escalation';
} else {
  next_step = 'issue_resolution';
}

next_step
```

### Data Validation
Check that data meets requirements before proceeding.

```javascript
const errors = [];
if (!customer_email) errors.push('Email required');
if (!customer_phone) errors.push('Phone required');
if (order_total < 0) errors.push('Invalid order total');

{
  isValid: errors.length === 0,
  errors: errors.join(', ')
}
```

## Related Pages

- [Structured Output](/platform/steps/structured-output) - Transform data into defined formats
- [Router](/platform/steps/router) - Route based on calculated values
- [LLM Step](/platform/steps/llm-step) - Generate AI-driven responses
